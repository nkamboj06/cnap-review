---
title: Covidence set-up
output: 
  html_document:
    tables: TRUE
---



```{r setup, include=FALSE}
library(tidyverse)
library(janitor)
library(knitr)
```

### Make sure all column headers have the 'cnap' and 'group' components 

The csv export from Covidence looks like it comes out in the order `outcome timepoint measure`. So we just have to add in some components to the timepoint part to make it consistent throughout.

In Covidence:

- Add in the type of cnap device to each timepoint (eg. nexfin or whatever was used)
- Add in 'primary' to the timepoint even for studies where there is only going to be one 'group' or for studies where there will be more than one 'group' use some other description for the group (eg. afib)
- Remove the underscore in all measurement components of the outcome (i.e. 'meanbias' instead of 'mean_bias' and 'lowerloa' instead of 'lower_loa')
- **Important that the timepoint is in the same order of cnapdevice_typecomparator_locationcomparator_group**


Below is an example dataframe that would come out if we include in the timepoint components for the cnap device (nexfin), type of comparator (invasive), location of comparator ( femoral/radial), group (primary or afib) separate by underscores. 

```{r}
df <- tribble(~study, ~`MAP nexfin_invasive_femoral_primary meanbias`, ~`MAP nexfin_invasive_radial_primary meanbias`, ~`MAP nexfin_invasive_femoral_afib meanbias`,~`SBP nexfin_invasive_femoral_primary lowerloa`, ~`SBP nexfin_invasive_femoral_primary upperloa`,
              "study1",12,3,5,-5, 20,
              "study2", 24,5,8, -15, 30) 

df %>% kable()
```


Then first thing we can do is clean the names so that the spaces get replaced by an underscore so that we can use those underscores to indicate the separation argument for pivot_longer below:

```{r}
df <- janitor::clean_names(df) 

```

Now we turn it into a 'long' dataframe so that it is easier to work with.

```{r}
df_long <- df %>% 
  pivot_longer(cols = -study,
               names_to = c("outcome", "cnap", "type","location", "group", "measure"),
               names_sep = "_",
                values_to = "value") 
df_long  %>% kable()
```

Now we can easily filter the observation by the values of any of the columns. In this instance below we want to create a subgroup of the results of studies that used the nexfin device where the comparator was invasive femoral artery blood pressure measurements.

```{r}
df_long %>% 
  filter(cnap=="nexfin" & type=="invasive" & location=="femoral") %>% kable()
```
